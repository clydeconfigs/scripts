#!/usr/bin/bash

get_gpu () {
     lspci | grep -i 'VGA' | awk -F': ' '{print $2}' | sed 's/(rev ..)//g' | head -n1 | sed -n 's/.*\[\(.*\)\].*/\1/p'
}

packages="Packages: $(tput sgr0)$(pacman -Qqe | wc -l) / $(pacman -Qq | wc -l)$(tput setaf 39)"
kernel="Kernel: $(tput sgr0)$(uname -r)$(tput setaf 39)"
shell="Shell: $(tput sgr0)$(echo $SHELL)$(tput setaf 39)"
term="Term: $(tput sgr0)$(echo $TERM)$(tput setaf 39)"

ram="RAM: $(tput sgr0)$(free --mega | awk '/^Mem:/ {print $3 "MB" " / " $2 "MB"}') "$(tput setaf 39)""
cpu="CPU: $(tput sgr0)$(echo $(grep -m1 'model name' /proc/cpuinfo | awk -F': ' '{print $2}' | sed 's/with.*$//'))$(tput setaf 39)"
gpu="GPU: $(tput sgr0)$(get_gpu)$(tput setaf 39)"
disk="Disk: $(tput sgr0)$(echo $(df -H | grep " /\b" -v | tail -n1 | awk '{ print $3"/"$2 }'))$(tput setaf 39)"

element=(
  "$packages"
  "$kernel"
  "$shell"
  "$term"
  "$disk"
  "$ram"
  "$cpu"
  "$gpu"
)

display_cpu=true
display_gpu=true
display_disk=true
display_ram=true

remove() {
    new_array=()
    for item in "${element[@]}"; do
        if [[ "$item" != "$1" ]]; then
            new_array+=("$item")
        fi
    done
    element=("${new_array[@]}")
}

help() {
    echo "help: you can chose elements to not display:
-c --no-cpu
-g --no-gpu
-d --no-disk
-r --no-ram
-s --no-shell
-p --no-packages
-k --no-kernel
-t --no-term"
}

while [[ $# -gt 0 ]]; do
    case "$1" in
        -t|--no-term)
            remove "$term"
            shift
            ;;
        -k|--no-kernel)
            remove "$kernel"
            shift
            ;;
        -p|--no-packages)
            remove "$packages"
            shift
            ;;
        -s|--no-shell)
            remove "$shell"
            shift
            ;;
        -c|--no-cpu)
            remove "$cpu"
            shift
            ;;
        -g|--no-gpu)
            remove "$gpu"
            shift
            ;;
        -d|--no-disk)
            remove "$disk"
            shift
            ;;
        -r|--no-ram)
            remove "$ram"
            shift
            ;;
        -h|--help)
            help
            exit 0
            ;;
       -*)
            arg="${1#-}"
            for ((i = 0; i < ${#arg}; i++)); do
                case "${arg:$i:1}" in
                    t)
                        remove "$term"
                        shift
                        ;;
                    k)
                        remove "$kernel"
                        shift
                        ;;
                    p)
                        remove "$packages"
                        shift
                        ;;
                    s)
                        remove "$shell"
                        shift
                        ;;
                    c)
                        remove "$cpu"
                        shift
                        ;;
                    g)
                        remove "$gpu"
                        shift
                        ;;
                    d)
                        remove "$disk"
                        shift
                        ;;
                    r)
                        remove "$ram"
                        shift
                        ;;
                esac
            done
            shift
            ;;
        *)
            echo "unknown option '$1'"
            help
            exit 1
            ;;
    esac
done

test -z "$(get_gpu)" && remove "$gpu"

echo -e "$(tput setaf 39)
     _             _
    / \   _ __ ___| |__       ${element[0]}
   / _ \ | '__/ __| '_ \\      ${element[1]}
  / ___ \| | | (__| | | |     ${element[2]}
 /_/   \_\_|  \___|_| |_|     ${element[3]}
  _     _                     
 | |   (_)_ __  _   ___  __   ${element[4]}
 | |   | | '_ \| | | \ \/ /   ${element[5]}
 | |___| | | | | |_| |>  <    ${element[6]}
 |_____|_|_| |_|\____/_/\_\\   ${element[7]}

$(tput sgr0)                              $(for c in $(seq 1 6); do tput setaf $c; echo -n "██"; done; tput sgr0; echo)
"

#
#  sfetch 1.2
#  created by clyde, on 18 feb 2024 at 16:39 CET
#

# clyde, on 3 mar 2024 at 15:33 CET 
# 1.0.2 patch notes: added the "Disk" line

# clyde, on 12 mar 2024 at 08:33 CET
# 1.0.3 patch notes: made the code cleaner with variables

# clyde, on 25 mar 2024 23:49 CET
# 1.1 patch notes: created more extensibility with $_1, $_2, etc.

# clyde, on 3 apr 2024 09:03 CEST (time change)
# 1.1.1 patch notes: added colors at the bottom

# clyde, on 5 apr 2024 17:36 CEST (time change)
# 1.2 patch notes: added options to ignore elements
